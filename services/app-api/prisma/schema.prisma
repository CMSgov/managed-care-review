generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-1.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model HealthPlanPackageTable {
  id        String                    @id
  stateCode String
  state     State                     @relation(fields: [stateCode], references: [stateCode])
  revisions HealthPlanRevisionTable[]
  questions Question[]
}

model ProtoMigrationsTable {
  migrationName String @id
}

model HealthPlanRevisionTable {
  id              String                 @id
  createdAt       DateTime
  pkgID           String
  formDataProto   Bytes
  submittedAt     DateTime?
  unlockedAt      DateTime?
  unlockedBy      String?
  unlockedReason  String?
  submittedBy     String?
  submittedReason String?
  pkg             HealthPlanPackageTable @relation(fields: [pkgID], references: [id])
}

model State {
  stateCode                   String                   @id
  name                        String
  latestStateSubmissionNumber Int                      @default(0)
  statePackages               HealthPlanPackageTable[]
  users                       User[]
}

model User {
  id               String     @id
  givenName        String
  familyName       String
  email            String
  role             Role
  stateAssignments State[]
  stateCode        String?
  questions        Question[]
}

model Question {
  id            String                 @id
  pkgID         String
  pkg           HealthPlanPackageTable @relation(fields: [pkgID], references: [id])
  createdAt     DateTime               @default(now())
  addedBy       User                   @relation(fields: [addedByUserID], references: [id])
  addedByUserID String
  documents     QuestionDocument[]
}

model QuestionDocument {
  id         String   @id
  name       String
  s3URL      String
  createdAt  DateTime @default(now())
  questionID String
  question   Question @relation(fields: [questionID], references: [id])
}

enum Role {
  CMS_USER
  STATE_USER
  ADMIN_USER
}
