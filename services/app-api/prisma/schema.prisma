// datasource requires a url. we override this with connection
// details from secrets manager in the application
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-1.0.x"]
}

// HealthPlanPackageTable
model HealthPlanPackageTable {
  id        String                    @id
  state     State                     @relation(fields: [stateCode], references: [stateCode])
  stateCode String
  revisions HealthPlanRevisionTable[]
}

// HealthPlanRevisionTable
model HealthPlanRevisionTable {
  id                  String          @id
  createdAt           DateTime
  pkg          HealthPlanPackageTable @relation(fields: [pkgID], references: [id])
  pkgID        String
  formDataProto Bytes
  unlockedBy          String?
  unlockedReason      String?
  unlockedAt          DateTime?
  submittedAt         DateTime?
  submittedBy         String?
  submittedReason     String?
}

model State {
  stateCode                   String            @id
  name                        String
  latestStateSubmissionNumber Int               @default(0)
  statePackages            HealthPlanPackageTable[]
}
