# Application Configuration

managed-care-review is [configured using env vars](https://12factor.net/config).

Different env vars can be set in different environments [local dev, review apps, dev, staging, prod] to configure things differently. Environment variables are individually mapped in the `deploy` and `promote` Github workflows for use in deployments. If a new environment variable is added, it should be mapped there as well.

For local dev, we use `.envrc` and `.envrc.local` to set the appropriate environment variables. Any local changes should be made to `.envrc.local`.

Also, CreateReactApp only loads env vars that start with `REACT_APP_`, so any configuration that needs to be read by app-web must start that way.

## List of Environment Variables

### `REACT_APP_AUTH_MODE`

Read by `app-api` and `app-web`.

valid values: `LOCAL`, `AWS_COGNITO`, `IDM`

This tells the application how to perform authentication.

`LOCAL` means to use local auth. Make no requests to cognito, there is custom auth UI in app-web to pick a user. app-web then sends the user as a JSON blob in a header that serverless-offline dumps into the context of our lambda's execution

`AWS_COGNITO` means to use AWS Cognito User Pools for auth. There is UI for creating and logging in with cognito in app-web and app-api can fetch user information from those users using a cognito api as well.

`IDM` means to use CMS IDM as the auth provider. This is what is set in dev/val/prod. Users will be redirected to login in IDM and then redirected back to our site. Cognito will create users in a special Okta user pool and then everything will work the same as if you were auth'd with `AWS_COGNITO` above.

### `REACT_APP_API_URL`

Read by `app-web`

valid values: A URL where app-api is running

This is the base URL that all requests are sent to from app-web

### `REACT_APP_COGNITO_*`

Read by `app-api`

-   REACT_APP_COGNITO_REGION
-   REACT_APP_COGNITO_ID_POOL_ID
-   REACT_APP_COGNITO_USER_POOL_ID
-   REACT_APP_COGNITO_USER_POOL_CLIENT_ID
-   REACT_APP_COGNITO_USER_POOL_CLIENT_DOMAIN

These four env vars configure cognito auth from the browser. They are ignored if `REACT_APP_AUTH_MODE` is set to `LOCAL` and thus are only set in deployed environments.

### `REACT_APP_APPLICATION_ENDPOINT`

Read by app-web

valid values: A URL where a running app-web can be reached

It's used as the redirects for login by app-web when it configures login via IDM.

### `APP_VERSION`

Read by `app-api`

Generated by ./scripts/app_version.sh as part of the build process, this is a short git hash of the running commit, with '-dirty' appended to it if it's not a clean git checkout.

### `OKTA_METADATA_URL`

Read by `ui-auth`

This is the metatdata URL configured for reaching out to Otka auth. Reqired for `IDM` type auth.

### `IAM_PATH`

### `DYNAMO_CONNECTION`

Read by `app-api` in configuring graphql to work with a DynamoDB store.
Valid values are any url (most likely `http://localhost:8000`), for a local run, and `USE_AWS` for use in deployed environments.

### `REACT_APP_S3_*`

Read by `app-web`

-   REACT_APP_S3_DOCUMENTS_BUCKET

The name of the bucket that documents are uploded to as part of the state submission form.

-   REACT_APP_S3_REGION

The region in AWS where the bucket is located. Cannot be set if REACT_APP_S3_LOCAL_URL is set.

-   REACT_APP_S3_LOCAL_URL

The local URL where an s3 server is being run. Cannot be set if REACT_APP_S3_REGION is set.

### `EMAILER_MODE`

Read by `app-api`

Determines which emailer to use, local or AWS SES emailer. Valid values are `LOCAL` or `SES`
